<!doctype html>
<html lang="eng">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='/favicon.ico') }}">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" crossorigin="anonymous"></script>
	<style>
        body {
            background: url({{ url_for('static', filename='media/images.jpeg') }}) no-repeat fixed;
            background-size: 100% 100%;
        }
        .container-fluid{
            -webkit-border-radius: .3rem;
            -moz-border-radius: .3rem;
            border-radius: .3rem;
            background: #e9ecef;
            padding: 0 0;
        }
		.row div {
            padding: 0 0;
            margin: 0 0;
        }
        .row div:first-child{
			overflow-x: hidden;
			overflow-y: auto;
		}
		.table {
			border-left: 2px solid #0005;
			border-right: 2px solid #0005;
            margin: 0 !important;
		}
		.table tr{
            text-align: center;
			border-bottom: 2px ridge #0003;
		}
        th{
            text-align: center !important;
        }
		.td:hover {
			color: white;
			background: grey;
		}
        .modal-header{
            color: white;
            background-color: #007bff;
        }
        .modal-body,
        .card-body{
            padding: 0;
        }
        .modal button{
            color: red;
        }
        .h4 {
            text-align: center;
            margin-top: 10px;
        }
        @media all and (min-width: 551px) {
            .container-fluid {
                width: 95%;
                height: 90%;
                position: absolute;
                top: 50%;
                transform: translate(5%, -50%);
            }
            .row {
                display: flex;
            }
            .row .col:first-child{
                max-width: 25%;
                border: 1px solid #0004;
                height: 100%;
            }
            .row .col:last-child{
                max-width: 75%;
            }
            td, th{
                padding: 16px !important;
            }
        }
        @media all and (max-width: 550px) {
            .container-fluid {
                margin: 0;
                width: 100%;
            }
            .row {
                display: grid;
                grid-template-rows: 35% 65%;
            }
            .row div:first-child{
                border: hidden;
                padding-bottom: 0;
                max-width: 100%;
            }
            .row div:last-child{
                max-width: 100%;
            }
            td, th{
                padding: 16px !important;
            }
        }
	</style>
	<title>Tracking establishments</title>
</head>
<body>
	<div class="row container-fluid">
		<div class="col">
			<table class="table table-bordered">
				<thead>
					<tr class="bg-primary text-white">
						<th>{{ establishment }}</th>
					</tr>
				</thead>
				<tbody>
                    {% for est in details %}
                        <tr>
						    <td class="td" data-target="#est{{ est['id'] }}" data-toggle="modal">{{ est['name'] | title }} ({{ est['distance'] }}km)</td>
					    </tr>
                    {% endfor %}
				</tbody>
			</table>
		</div>
        <div class="col">
            <iframe id="MapFrame" width="100%" height="100%"></iframe>
        </div>
	</div>
    {% for est in details %}
        <div class="modal fade" id="est{{ est['id'] }}">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">{{ est['name'] }}</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="card-body">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <th>Distance</th>
                                        <td>{{ est['distance'] }}km</td>
                                    </tr>
                                    {% for (key,value) in est.items() %}
                                        {% if key not in ["id", "lon", "lat", "name", "distance"] %}
                                            <tr>
                                                <th>{{ key.capitalize() }}</th>
                                                <td>{{ value.replace('_',' ').capitalize() }}</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    <script>
        function warn(){
            if(`{{ lazy }}`=== "True")
                alert("Warning: Establishments listed may be incomplete. You can go back and rerun.");
        }
        function fixSizes(){
            let height = window.innerHeight;
            if(window.innerWidth <= 550){
                $('.container-fluid').css("height", height);
            }
            else{
                $('.container-fluid').css("height", "90%");
            }
        }
        $(window).ready(function() {
            $.ajax({
                url: "/map",
                success: function () {
                    $("#MapFrame")[0].src = "/map";
                },
                statusCode: {
                    500: function () {
                        window.location.href = '/';
                    }
                }
            });
            fixSizes();
            warn();
        });
        $(window).resize(fixSizes);
    </script>
</body>
</html>
